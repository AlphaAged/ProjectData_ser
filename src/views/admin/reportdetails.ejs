<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CP KKU Study Notes</title>
  <link rel="stylesheet" href="/style.css"/>
</head>
<body>

<main class="container">
<h2>รายละเอียดปัญหา</h2>
<p><b>ปัญหา: </b> <%= report.reasonTitle %></p>
<p><b>รายละเอียดปัญหา: </b> <%= report.reasonBody %></p>
<p><b>สถานะการดำเนินการปัจจุบัน: </b> <%= report.status %></p>
<p><b>วันที่รายงาน:</b> <%= report.createdAt.toLocaleString() %></p>

<% if (originalItem) { %>
  <% if (originalItem.deleted) { %>
    <p style="color:red;">ต้นทางถูกลบไปแล้ว</p>
  <% } else { %>
    <a href="<%= type==='post' ? '/posts/' + originalItem.slug : '/threads/' + originalItem._id %>" target="_blank">
  ไปยัง<%= type==='post' ? 'โพสต์' : 'กระทู้' %>ต้นฉบับ
</a>

  <% } %>
<% } else { %>
  <p style="color:red;">ต้นทางไม่พบในฐานข้อมูล</p>
<% } %>

<div style="display: flex; align-items: center; gap: 10px;">
<form method="post" action="/admin/reports/<%= type %>/<%= originalItem._id %>/<%= reportIdx %>/status">
  <select name="status">
    <option value="pending" <%= report.status==='pending'?'selected':'' %>>ยังไม่ดำเนินการ</option>
    <option value="in_progress" <%= report.status==='in_progress'?'selected':'' %>>กำลังดำเนินการ</option>
    <option value="resolved" <%= report.status==='resolved'?'selected':'' %>>ดำเนินการเสร็จสิ้น</option>
  </select>
  <button>อัปเดตสถานะการดำเนินการ</button>
</form>
<form method="post" action="/admin/reports/<%= type %>/<%= originalItem._id %>/<%= reportIdx %>/delete" onsubmit="return confirm('ต้องการลบปัญหานี้จริงหรือไม่?');">
  <button style="background-color: crimson; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer;">
    ลบปัญหา
  </button>
</form>
</div>

</main>
</body>
</html>
