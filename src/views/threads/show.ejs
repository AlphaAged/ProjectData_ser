<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CP KKU Study Notes</title>
  <link rel="stylesheet" href="/style.css"/>
</head>
<body>

<main class="container">
<h2><%= thread.title %></h2>
<p class="muted">โดย <%= thread.author?.username %></p>
<p><%= thread.body %></p>
<div class="row">
  <form method="post" action="/threads/<%= thread._id %>/like"><button>ถูกใจ</button></form>

  <% if (currentUser && (currentUser.id === String(thread.author._id) || currentUser.role==='admin')){ %>
    <form method="post" action="/threads/<%= thread._id %>/delete">
      <button class="danger">ลบกระทู้</button>
    </form>
  <% } else if (currentUser) { %>
    <a class="button" href="/threads/<%= thread._id %>/report">รายงาน</a>
  <% } %>
</div>

<hr/>
<h3>คำตอบ</h3>
<ul class="comments">
  <% thread.replies.forEach(r=>{ %>
    <li><b><%= r.author?.username %></b> <span class="muted"><%= new Date(r.createdAt).toLocaleString() %></span><br/><%= r.body %></li>
  <% }) %>
</ul>
<% if (currentUser){ %>
<form method="post" action="/threads/<%= thread._id %>/replies">
  <textarea name="body" rows="3" required></textarea>
  <button>ตอบ</button>
</form>
<% } %>
</main>
</body>
</html>
