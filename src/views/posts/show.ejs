<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CP KKU Study Notes</title>
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <%- include('../partials/header') %>
    <main class="container">
      <article class="post">
        <% if (post.coverImage){ %><img src="<%= post.coverImage %>" class="cover-xl" />
          <% } %>
            <h1>
              <%= post.title %>
            </h1>
            <p class="muted">‡πÇ‡∏î‡∏¢ <%= post.author?.username %> ¬∑ ‚ô• <%= post.likes.length %> ¬∑ üëÅÔ∏è <%= post.views %>
            </p>
            <div class="tags">
              <% (post.tags||[]).forEach(t=>{ %><span class="tag">
                  <%= t %>
                </span>
                <% }) %>
            </div>
            <p>
              <%= post.body %>
            </p>
            <div class="row">
              <form method="post" action="/posts/<%= post.slug %>/like">
                <button class="icon-btn like-btn" type="submit">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-heart-icon lucide-heart">
                    <path
                      d="M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5" />
                  </svg>
                  ‡∏ñ‡∏π‡∏Å‡πÉ‡∏à
                </button>
              </form>
              <% if (currentUser && (currentUser.id===String(post.author._id) || currentUser.role==='admin' )){ %>
                <a class="icon-btn button" id="edit-btn" href="/posts/<%= post.slug %>/edit">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-pencil-icon lucide-pencil">
                    <path
                      d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z" />
                    <path d="m15 5 4 4" />
                  </svg>
                  ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                </a>
                <form method="post" action="/posts/<%= post.slug %>/delete"><button class="danger">‡∏•‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
                </form>
                <% } else if (currentUser) { %>
                  <a class="icon-btn button" id="report-btn" href="/posts/<%= post.slug %>/report">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round"
                      class="lucide lucide-flag-icon lucide-flag">
                      <path
                        d="M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528" />
                    </svg>
                    ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                  </a>
                  <% } %>
            </div>
            <% if (currentUser) { %>
              <button id="save-post-btn" class="icon-btn" data-slug="<%= post.slug %>">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bookmark-icon lucide-bookmark"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/></svg>
                <%= currentUser.savePosts && currentUser.savePosts.includes(String(post._id)) ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'
                  : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏û‡∏™‡∏ï‡πå' %>
              </button>
              <% } %>
                <hr />
                <h3>‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå</h3>
                <ul class="comments">
                  <% post.comments.forEach(c=>{ %>
                    <li><b>
                        <%= c.author?.username %>
                      </b> <span class="muted">
                        <%= new Date(c.createdAt).toLocaleString() %>
                      </span><br />
                      <%= c.body %>
                    </li>
                    <% }) %>
                </ul>
                <% if (currentUser){ %>
                  <form method="post" action="/posts/<%= post.slug %>/comments">
                    <textarea name="body" rows="3" required></textarea>
                    <button>‡∏™‡πà‡∏á‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå</button>
                  </form>
                  <% } else { %>
                    <p class="muted">‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå</p>
                    <% } %>
      </article>
    </main>
</body>
<script src="/js/save-post.js"></script>

</html>