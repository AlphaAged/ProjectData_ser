<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CP KKU Study Notes</title>
  <link rel="stylesheet" href="/style.css"/>
</head>
<body>

<main class="container" style="padding-bottom: 20px;">
<div class="hero">
  <h1>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà CP KKU Study Notes</h1>
  <p class="muted">‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏õ‡∏±‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
</div>


<div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
    <div>
      <% if ((typeof q !== 'undefined' && q) || (typeof tag !== 'undefined' && tag)) { %>
        <h3 style="margin:0;">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ <%= q ? `"${q}"` : '' %> <%= tag ? `[${tag}]` : '' %></h3>
      <% } else { %>
        <h3 style="margin:0;">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
      <% } %>
    </div>
    <form class="row" method="get" action="/" style="gap:0.5rem;">
      <input name="q" placeholder="‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô" value="<%= typeof q !== 'undefined' ? q : '' %>"/>
      <select name="tag">
        <option value="">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        <% 
          const selectedTag = typeof tag !== 'undefined' ? tag : '';
          ['CS','AI','IT','CY','GIS','Physics','Chemistry','Biology','Math','English','GE','Free'].forEach(t=>{ 
        %>
          <option value="<%= t %>" <%= selectedTag===t?'selected':'' %>><%= t %></option>
        <% }) %>
      </select>
      <button>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
    </form>
  </div>

  <% if ((typeof q !== 'undefined' && q) || (typeof tag !== 'undefined' && tag)) { %>
    <% if (posts.length === 0) { %>
      <p class="muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</p>
    <% } %>
  <% } %>
<div class="grid">
  <% posts.forEach(p=>{ %>
    <div class="card-container">
    <a class="card" href="/posts/<%= p.slug %>">
      <% if (p.coverImage){ %><img src="<%= p.coverImage %>" class="cover"/><% } %>
      <div class="pad">
        <h3 class="ellipsis"><%= p.title %></h3>
        <p class="muted">by <%= p.author?.username %> ¬∑ ‚ô• <%= p.likes.length %> ¬∑ üëÅÔ∏è <%= p.views %></p>
         <!-- <p class="muted">
            by <%= p.author?.username %> ¬∑ 
            <button 
              type="button" 
              class="like-btn" 
              data-slug="<%= p.slug %>">
              ‚ô• <span class="like-count"><%= p.likes.length %></span>
            </button>
            ¬∑ üëÅÔ∏è <%= p.views %>
          </p> -->


        <div class="tags">
          <% (p.tags||[]).forEach(t=>{ %><span class="tag"><%= t %></span><% }) %>
        </div>
      </div>
    </a>
    </div>
  <% }) %>
</div>
</main>

<a href="/posts/new" class="fab" aria-label="‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà">
  <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
    <path d="M11 5a1 1 0 0 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6V5z" fill="currentColor"/>
  </svg>
</a>
</a>
<!-- 
<script>
document.querySelectorAll('.like-btn').forEach(btn => {
  btn.addEventListener('click', async function() {
    const slug = this.dataset.slug;
    const res = await fetch(`/posts/${slug}/like`, { method: 'POST' });
    if (res.ok) {
      const data = await res.json();
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏•‡∏Ñ‡πå‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°
      this.querySelector('.like-count').textContent = data.likes;
      // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
      if(data.liked) {
        this.style.color = 'red';
      } else {
        this.style.color = '';
      }
    }
  });
});
</script> -->

</body>
</html>
